
<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <title>Hi3861开发板使用与第六届全国大学生嵌入式竞赛海思赛道 | EZ0328</title>
        <meta name="author" content="Eric Zhang" />
        <meta name="description" content="Be creative, be innovative" />
        <meta name="keywords" content="" />
        <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
        <link rel="icon" href="/images/avatar.jpg" />
        <script src="https://cdn.staticfile.org/vue/3.2.47/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.3.0/css/all.min.css" />
<link rel="stylesheet" href="/css/fonts.min.css" />
<script> const mixins = {}; </script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>


<script src="https://cdn.staticfile.org/highlight.js/11.7.0/highlight.min.js"></script>
<link
    rel="stylesheet"
    href="https://cdn.staticfile.org/highlight.js/11.7.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>



<script src="/js/lib/preview.js"></script>





<script src="https://cdn.staticfile.org/gitalk/1.8.0/gitalk.min.js"></script>
<link rel="stylesheet" href="https://cdn.staticfile.org/gitalk/1.8.0/gitalk.min.css" />





<link rel="stylesheet" href="/css/main.css" />

    <meta name="generator" content="Hexo 6.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>
    <body>
        <div id="layout">
            <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存&ensp;浏览器默认开启</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
            </transition>
            <transition name="into">
            <div id="main" v-show="!loading">
                <nav id="menu" ref="menu">
    <div class="desktop-menu">
        <a class="title" href="/">
            <span>EZ0328</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </div>
    <div id="mobile-menu">
        <div class="curtain" v-show="showMenu" @click="showMenu = !showMenu"></div>
        <div class="title" @click="showMenu = !showMenu">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;EZ0328</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="showMenu">
            
            <a href="/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                </div>
            </a>
            
            <a href="/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                </div>
            </a>
            
            <a href="/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                </div>
            </a>
            
            <a href="/categories">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                </div>
            </a>
            
            <a href="/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>

                <div class="article">
    <div>
        <h1>Hi3861开发板使用与第六届全国大学生嵌入式竞赛海思赛道</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2023/3/27
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            <span class="tag">
                
                <a href="/tags/%E6%B5%B7%E6%80%9D/" style="color: #00bcd4">海思</a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%A4%A7%E8%B5%9B/" style="color: #ffa2c4">嵌入式大赛</a>
            </span>
            
        </span>
        
    </div>
    
    <div class="content" v-pre>
        <h1 id="参考资料">参考资料</h1>
<p>海思技术论坛注册：<a target="_blank" rel="noopener" href="https://developer.hisilicon.com/forum/all" class="uri">https://developer.hisilicon.com/forum/all</a></p>
<p>嵌入式物联网学习资料总入口：<a target="_blank" rel="noopener" href="https://developer.hisilicon.com/postDetail?tid=0206112614830760003" class="uri">https://developer.hisilicon.com/postDetail?tid=0206112614830760003</a></p>
<p>海思技术论坛<a target="_blank" rel="noopener" href="https://developer.hisilicon.com/forum/all" class="uri">https://developer.hisilicon.com/forum/all</a></p>
<p>2023海思嵌入式大赛学习文档仓库Gitee：<a target="_blank" rel="noopener" href="https://gitee.com/HiSpark/HiSpark_NICU2023" class="uri">https://gitee.com/HiSpark/HiSpark_NICU2023</a></p>
<p>HUAWEI_Cloud与Android Studio开发联动：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43351158/article/details/124476656" class="uri">https://blog.csdn.net/weixin_43351158/article/details/124476656</a>
<span id="more"></span></p>
<h1 id="工程结构分析">工程结构分析</h1>
<h2 id="工程目录">工程目录</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="bu">.</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> applications</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> sample</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>        <span class="ex">└──</span> wifi-iot</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>            <span class="ex">└──</span> app</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>                <span class="ex">│──</span> my_first_app     //业务my_first_app文件夹</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>                <span class="ex">│</span>  │── hello_world.c //业务代码</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>                <span class="ex">│</span>  └── BUILD.gn      //编译脚本</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>                <span class="ex">└──</span> BUILD.gn</span></code></pre></div>
<h2 id="hello_world.c文件代码结构">hello_world.c文件代码结构</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"ohos_init.h"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"ohos_types.h"</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> HelloWorld<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"___________&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; [DEMO] Hello world.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>SYS_RUN<span class="op">(</span>HelloWorld<span class="op">);</span></span></code></pre></div>
<p>SYS_RUN定义在ohos_init.h文件中，是<strong>HarmonyOS启动恢复模块接口启动业务</strong>。</p>
<h2 id="用于将业务构建成静态库的build.gn文件代码结构"><em>用于将业务构建成静态库</em>的BUILD.gn文件代码结构</h2>
<p>路径：./applications/sample/wifi-iot/app/my_first_app/BUILD.gn（与下面的模块编译build.gn不一样，请格外注意）</p>
<pre class="gn"><code>//目标业务
static_library("myapp") { 
    //源文件路径
    sources = [
        "hello_world.c"
    ]
    //头文件路径
    include_dirs = [
        "//utils/native/lite/include"
    ]
}</code></pre>
<h2 id="指定需参与构建的特性模块的build.gn文件代码结构"><em>指定需参与构建的特性模块</em>的BUILD.gn文件代码结构</h2>
<p>路径：./applications/sample/wifi-iot/app/BUILD.gn</p>
<pre class="gn"><code>import("//build/lite/config/component/lite_component.gni")


lite_component("app") {
    features = [
        "my_first_app:myapp",
    ]

}</code></pre>
<p>my_first_app是相对路径，指向./applications/sample/wifi-iot/app/my_first_app/BUILD.gn。</p>
<p>myapp是目标，指向./applications/sample/wifi-iot/app/my_first_app/BUILD.gn中的static_library("myapp")。</p>
<h1 id="hi3861其他代码结构">Hi3861其他代码结构</h1>
<h2 id="hi3861平台配置文件">Hi3861平台配置文件</h2>
<p>hi3861平台配置文件位于：vendor_pegasus.json</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"product_name"</span><span class="fu">:</span> <span class="st">"wifiiot_hispark_pegasus"</span><span class="fu">,</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"ohos_version"</span><span class="fu">:</span> <span class="st">"OpenHarmony 1.0"</span><span class="fu">,</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"device_company"</span><span class="fu">:</span> <span class="st">"hisilicon"</span><span class="fu">,</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"board"</span><span class="fu">:</span> <span class="st">"hispark_pegasus"</span><span class="fu">,</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"kernel_type"</span><span class="fu">:</span> <span class="st">"liteos_m"</span><span class="fu">,</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"kernel_version"</span><span class="fu">:</span> <span class="st">""</span><span class="fu">,</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"subsystems"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        <span class="er">//应用子系统</span><span class="fu">,</span><span class="er">存放了hi3681编写的应用程序代码</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"subsystem"</span><span class="fu">:</span> <span class="st">"applications"</span><span class="fu">,</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"components"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>          <span class="fu">{</span> <span class="dt">"component"</span><span class="fu">:</span> <span class="st">"wifi_iot_sample_app"</span><span class="fu">,</span> <span class="dt">"features"</span><span class="fu">:</span><span class="ot">[]</span> <span class="fu">}</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        <span class="ot">]</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        <span class="er">//硬件驱动子系统</span><span class="fu">,</span><span class="er">存放了hi3681的硬件驱动代码</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"subsystem"</span><span class="fu">:</span> <span class="st">"iot_hardware"</span><span class="fu">,</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"components"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>          <span class="fu">{</span> <span class="dt">"component"</span><span class="fu">:</span> <span class="st">"iot_controller"</span><span class="fu">,</span> <span class="dt">"features"</span><span class="fu">:</span><span class="ot">[]</span> <span class="fu">}</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>        <span class="ot">]</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>        <span class="er">//</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"subsystem"</span><span class="fu">:</span> <span class="st">"hiviewdfx"</span><span class="fu">,</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"components"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>          <span class="fu">{</span> <span class="dt">"component"</span><span class="fu">:</span> <span class="st">"hilog_lite"</span><span class="fu">,</span> <span class="dt">"features"</span><span class="fu">:</span><span class="ot">[]</span> <span class="fu">}</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>        <span class="ot">]</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"subsystem"</span><span class="fu">:</span> <span class="st">"distributed_schedule"</span><span class="fu">,</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"components"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>          <span class="fu">{</span> <span class="dt">"component"</span><span class="fu">:</span> <span class="st">"samgr_lite"</span><span class="fu">,</span> <span class="dt">"features"</span><span class="fu">:</span><span class="ot">[]</span> <span class="fu">}</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>        <span class="ot">]</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"subsystem"</span><span class="fu">:</span> <span class="st">"security"</span><span class="fu">,</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"components"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>          <span class="fu">{</span> <span class="dt">"component"</span><span class="fu">:</span> <span class="st">"hichainsdk"</span><span class="fu">,</span> <span class="dt">"features"</span><span class="fu">:</span><span class="ot">[]</span> <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>          <span class="fu">{</span> <span class="dt">"component"</span><span class="fu">:</span> <span class="st">"deviceauth_lite"</span><span class="fu">,</span> <span class="dt">"features"</span><span class="fu">:</span><span class="ot">[]</span> <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>          <span class="fu">{</span> <span class="dt">"component"</span><span class="fu">:</span> <span class="st">"huks"</span><span class="fu">,</span> <span class="dt">"features"</span><span class="fu">:</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>            <span class="ot">[</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>              <span class="st">"disable_huks_binary = false"</span><span class="ot">,</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>              <span class="st">"disable_authenticate = false"</span><span class="ot">,</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>              <span class="st">"huks_use_lite_storage = true"</span><span class="ot">,</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>              <span class="st">"huks_use_hardware_root_key = true"</span><span class="ot">,</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>              <span class="st">"huks_config_file = </span><span class="ch">\"</span><span class="st">hks_config_lite.h</span><span class="ch">\"</span><span class="st">"</span><span class="ot">,</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>              <span class="st">"huks_mbedtls_path = </span><span class="ch">\"</span><span class="st">//device/hisilicon/hispark_pegasus/sdk_liteos/third_party/mbedtls/include/</span><span class="ch">\"</span><span class="st">"</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>            <span class="ot">]</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>        <span class="ot">]</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"subsystem"</span><span class="fu">:</span> <span class="st">"startup"</span><span class="fu">,</span></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"components"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>          <span class="fu">{</span> <span class="dt">"component"</span><span class="fu">:</span> <span class="st">"bootstrap_lite"</span><span class="fu">,</span> <span class="dt">"features"</span><span class="fu">:</span><span class="ot">[]</span> <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>          <span class="fu">{</span> <span class="dt">"component"</span><span class="fu">:</span> <span class="st">"syspara_lite"</span><span class="fu">,</span> <span class="dt">"features"</span><span class="fu">:</span></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>            <span class="ot">[</span></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>              <span class="st">"enable_ohos_startup_syspara_lite_use_thirdparty_mbedtls = false"</span></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>            <span class="ot">]</span></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>        <span class="ot">]</span></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{</span></span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"subsystem"</span><span class="fu">:</span> <span class="st">"communication"</span><span class="fu">,</span></span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"components"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>          <span class="fu">{</span> <span class="dt">"component"</span><span class="fu">:</span> <span class="st">"wifi_lite"</span><span class="fu">,</span> <span class="dt">"features"</span><span class="fu">:</span><span class="ot">[]</span> <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>          <span class="fu">{</span> <span class="dt">"component"</span><span class="fu">:</span> <span class="st">"softbus_lite"</span><span class="fu">,</span> <span class="dt">"features"</span><span class="fu">:</span><span class="ot">[]</span> <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>          <span class="fu">{</span> <span class="dt">"component"</span><span class="fu">:</span> <span class="st">"wifi_aware"</span><span class="fu">,</span> <span class="dt">"features"</span><span class="fu">:</span><span class="ot">[]</span><span class="fu">}</span></span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>        <span class="ot">]</span></span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{</span></span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"subsystem"</span><span class="fu">:</span> <span class="st">"update"</span><span class="fu">,</span></span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"components"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>          <span class="fu">{</span> <span class="dt">"component"</span><span class="fu">:</span> <span class="st">"ota_lite"</span><span class="fu">,</span> <span class="dt">"features"</span><span class="fu">:</span><span class="ot">[]</span> <span class="fu">}</span></span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>        <span class="ot">]</span></span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{</span></span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"subsystem"</span><span class="fu">:</span> <span class="st">"iot"</span><span class="fu">,</span></span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"components"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>          <span class="fu">{</span> <span class="dt">"component"</span><span class="fu">:</span> <span class="st">"iot_link"</span><span class="fu">,</span> <span class="dt">"features"</span><span class="fu">:</span><span class="ot">[]</span> <span class="fu">}</span></span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>        <span class="ot">]</span></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{</span></span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"subsystem"</span><span class="fu">:</span> <span class="st">"utils"</span><span class="fu">,</span></span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"components"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a>          <span class="fu">{</span> <span class="dt">"component"</span><span class="fu">:</span> <span class="st">"file"</span><span class="fu">,</span> <span class="dt">"features"</span><span class="fu">:</span><span class="ot">[]</span> <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>          <span class="fu">{</span> <span class="dt">"component"</span><span class="fu">:</span> <span class="st">"kv_store"</span><span class="fu">,</span> <span class="dt">"features"</span><span class="fu">:</span><span class="ot">[]</span> <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a>          <span class="fu">{</span> <span class="dt">"component"</span><span class="fu">:</span> <span class="st">"os_dump"</span><span class="fu">,</span> <span class="dt">"features"</span><span class="fu">:</span><span class="ot">[]</span> <span class="fu">}</span></span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a>        <span class="ot">]</span></span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{</span></span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"subsystem"</span><span class="fu">:</span> <span class="st">"vendor"</span><span class="fu">,</span></span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"components"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a>          <span class="fu">{</span> <span class="dt">"component"</span><span class="fu">:</span> <span class="st">"hi3861_sdk"</span><span class="fu">,</span> <span class="dt">"target"</span><span class="fu">:</span> <span class="st">"//device/hisilicon/hispark_pegasus/sdk_liteos:wifiiot_sdk"</span><span class="fu">,</span> <span class="dt">"features"</span><span class="fu">:</span><span class="ot">[]</span> <span class="fu">}</span></span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a>        <span class="ot">]</span></span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"third_party_dir"</span><span class="fu">:</span> <span class="st">"//device/hisilicon/hispark_pegasus/sdk_liteos/third_party"</span><span class="fu">,</span></span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"product_adapter_dir"</span><span class="fu">:</span> <span class="st">"//vendor/hisilicon/hispark_pegasus/hals"</span></span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span></code></pre></div>
<p>hi3861用的是<strong>liteos-m</strong>内核，但是目前hi3681的liteos-m被<strong>芯片rom化</strong>了，固化在芯片内部了。所以在harmonyOS代码是找不到hi3861的内核部分。</p>
<h1 id="hi3861启动流程">Hi3861启动流程</h1>
<h2 id="第一个入口函数">第一个入口函数</h2>
<p>路径:._pegasus_liteos_app_main.c</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>hi_void app_main<span class="op">(</span>hi_void<span class="op">)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifdef CONFIG_FACTORY_TEST_MODE</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"factory test mode!</span><span class="sc">\r\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> hi_char<span class="op">*</span> sdk_ver <span class="op">=</span> hi_get_sdk_version<span class="op">();</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"sdk ver:%s</span><span class="sc">\r\n</span><span class="st">"</span><span class="op">,</span> sdk_ver<span class="op">);</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    hi_flash_partition_table <span class="op">*</span>ptable <span class="op">=</span> HI_NULL<span class="op">;</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    peripheral_init<span class="op">();</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    peripheral_init_no_sleep<span class="op">();</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef CONFIG_FACTORY_TEST_MODE</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    hi_lpc_register_wakeup_entry<span class="op">(</span>peripheral_init<span class="op">);</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    hi_u32 ret <span class="op">=</span> hi_factory_nv_init<span class="op">(</span>HI_FNV_DEFAULT_ADDR<span class="op">,</span> HI_NV_DEFAULT_TOTAL_SIZE<span class="op">,</span> HI_NV_DEFAULT_BLOCK_SIZE<span class="op">);</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ret <span class="op">!=</span> HI_ERR_SUCCESS<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"factory nv init fail</span><span class="sc">\r\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* partion table should init after factory nv init. */</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    ret <span class="op">=</span> hi_flash_partition_init<span class="op">();</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ret <span class="op">!=</span> HI_ERR_SUCCESS<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"flash partition table init fail:0x%x </span><span class="sc">\r\n</span><span class="st">"</span><span class="op">,</span> ret<span class="op">);</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    ptable <span class="op">=</span> hi_get_partition_table<span class="op">();</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    ret <span class="op">=</span> hi_nv_init<span class="op">(</span>ptable<span class="op">-&gt;</span>table<span class="op">[</span>HI_FLASH_PARTITON_NORMAL_NV<span class="op">].</span>addr<span class="op">,</span> ptable<span class="op">-&gt;</span>table<span class="op">[</span>HI_FLASH_PARTITON_NORMAL_NV<span class="op">].</span>size<span class="op">,</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>        HI_NV_DEFAULT_BLOCK_SIZE<span class="op">);</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ret <span class="op">!=</span> HI_ERR_SUCCESS<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"nv init fail</span><span class="sc">\r\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef CONFIG_FACTORY_TEST_MODE</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>    hi_upg_init<span class="op">();</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* if not use file system, there is no need init it */</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    hi_fs_init<span class="op">();</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span>hi_void<span class="op">)</span>hi_event_init<span class="op">(</span>APP_INIT_EVENT_NUM<span class="op">,</span> HI_NULL<span class="op">);</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    hi_sal_init<span class="op">();</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* 此处设为TRUE后中断中看门狗复位会显示复位时PC值，但有复位不完全风险，量产版本请务必设为FALSE */</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    hi_syserr_watchdog_debug<span class="op">(</span>HI_FALSE<span class="op">);</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* 默认记录宕机信息到FLASH，根据应用场景，可不记录，避免频繁异常宕机情况损耗FLASH寿命 */</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>    hi_syserr_record_crash_info<span class="op">(</span>HI_TRUE<span class="op">);</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>    hi_lpc_init<span class="op">();</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>    hi_lpc_register_hw_handler<span class="op">(</span>config_before_sleep<span class="op">,</span> config_after_sleep<span class="op">);</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a><span class="pp">#if defined(CONFIG_AT_COMMAND) || defined(CONFIG_FACTORY_TEST_MODE)</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>    ret <span class="op">=</span> hi_at_init<span class="op">();</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ret <span class="op">==</span> HI_ERR_SUCCESS<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>        hi_at_sys_cmd_register<span class="op">();</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* 如果不需要使用Histudio查看WIFI驱动运行日志等，无需初始化diag */</span></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* if not use histudio for diagnostic, diag initialization is unnecessary */</span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Shell and Diag use the same uart port, only one of them can be selected */</span></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef CONFIG_FACTORY_TEST_MODE</span></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef ENABLE_SHELL_DEBUG</span></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifdef CONFIG_DIAG_SUPPORT</span></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span>hi_void<span class="op">)</span>hi_diag_init<span class="op">();</span></span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a><span class="pp">#else</span></span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span>hi_void<span class="op">)</span>hi_shell_init<span class="op">();</span></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>    tcpip_init<span class="op">(</span>NULL<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>    ret <span class="op">=</span> hi_wifi_init<span class="op">(</span>APP_INIT_VAP_NUM<span class="op">,</span> APP_INIT_USR_NUM<span class="op">);</span></span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ret <span class="op">!=</span> HISI_OK<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"wifi init failed!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"wifi init success!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>    app_demo_task_release_mem<span class="op">();</span> <span class="co">/* 释放系统栈内存所使用任务 */</span></span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef CONFIG_FACTORY_TEST_MODE</span></span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a>    app_demo_upg_init<span class="op">();</span></span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifdef CONFIG_HILINK</span></span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>    ret <span class="op">=</span> hilink_main<span class="op">();</span></span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ret <span class="op">!=</span> HISI_OK<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"hilink init failed!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"hilink init success!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a>    OHOS_Main<span class="op">();</span></span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>最后一行调用OHOS_Main()代码：</p>
<p>路径：._pegasus_liteos_app</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> OHOS_Main<span class="op">()</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#if defined(CONFIG_AT_COMMAND) || defined(CONFIG_FACTORY_TEST_MODE)</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    hi_u32 ret<span class="op">;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ret <span class="op">=</span> hi_at_init<span class="op">();</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ret <span class="op">==</span> HI_ERR_SUCCESS<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>        hi_u32 ret2 <span class="op">=</span> hi_at_register_cmd<span class="op">(</span>G_OHOS_AT_FUNC_TBL<span class="op">,</span> OHOS_AT_FUNC_NUM<span class="op">);</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>ret2 <span class="op">!=</span> HI_ERR_SUCCESS<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">"Register ohos failed!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    OHOS_SystemInit<span class="op">();</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>OHOS_SystemInit函数进行鸿蒙系统的初始化。</p>
<p>路径：D:_test_lite_init.c</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> OHOS_SystemInit<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    MODULE_INIT<span class="op">(</span>bsp<span class="op">);</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    MODULE_INIT<span class="op">(</span>device<span class="op">);</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    MODULE_INIT<span class="op">(</span>core<span class="op">);</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    SYS_INIT<span class="op">(</span>service<span class="op">);</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    SYS_INIT<span class="op">(</span>feature<span class="op">);</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    MODULE_INIT<span class="op">(</span>run<span class="op">);</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    SAMGR_Bootstrap<span class="op">();</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>主要是初始化了一些相关模块、系统，包括有bsp、device（设备）。其中最终的是MODULE_INIT(run)；负责调用所有run段的代码：<strong>前面application中使用SYS_RUN()宏设置的函数名</strong>。</p>
<h1 id="一gpio的使用">一、GPIO的使用</h1>
<h2 id="api说明">API说明</h2>
<h3 id="iotgpioinit">1. IoTGpioInit()</h3>
<p>作用：初始化指定的IO口 示例：</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// LED3的GPIO初始化 GPIO initialization of LED3</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    IoTGpioInit<span class="op">(</span>IOT_IO_NAME_GPIO_9<span class="op">);</span></span></code></pre></div>
<p>依赖库：src_hardware_gpio.h, 说明如下</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> Initializes a GPIO device.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"> *</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">id</span><span class="co"> Indicates the GPIO pin number.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@return</span><span class="co"> Returns {</span><span class="an">@link</span><span class="co"> </span><span class="cv">IOT_SUCCESS}</span><span class="co"> if the GPIO device is initialized;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * returns {</span><span class="an">@link</span><span class="co"> </span><span class="cv">IOT_FAILURE}</span><span class="co"> otherwise. For details about other return values, see the chip description.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@since</span><span class="co"> 2.2</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@version</span><span class="co"> </span><span class="cv">2.2</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">int</span> IoTGpioInit<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">int</span> id<span class="op">);</span></span></code></pre></div>
<h3 id="iosetfunc">2. IoSetFunc()</h3>
<p>作用：配置指定IO的复用功能 示例：</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 设置GPIO9的管脚复用关系为GPIO Set the pin reuse relationship of GPIO9 to GPIO</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    IoSetFunc<span class="op">(</span>IOT_IO_NAME_GPIO_9<span class="op">,</span> IOT_IO_FUNC_GPIO_9_GPIO<span class="op">);</span></span></code></pre></div>
<p>依赖库：src-iot_demo_iot_gpio_ex.c 说明如下：</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">int</span> IoSetFunc<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">int</span> id<span class="op">,</span> <span class="dt">unsigned</span> <span class="dt">char</span> val<span class="op">)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>id <span class="op">&gt;=</span> HI_GPIO_IDX_MAX<span class="op">)</span> <span class="op">{</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> IOT_FAILURE<span class="op">;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> hi_io_set_func<span class="op">((</span>hi_io_name<span class="op">)</span>id<span class="op">,</span> val<span class="op">);</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="iotgpiosetdir">3. IoTGpioSetDir()</h3>
<p>作用：设置指定IO的管脚方向 示例：</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// GPIO方向设置为输出 GPIO direction set to output</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    IoTGpioSetDir<span class="op">(</span>IOT_IO_NAME_GPIO_9<span class="op">,</span> IOT_GPIO_DIR_OUT<span class="op">);</span></span></code></pre></div>
<p>依赖库：src_hardware_gpio.h, 说明如下</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> Sets the direction for a GPIO pin.</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"> *</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">id</span><span class="co"> Indicates the GPIO pin number.</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">dir</span><span class="co"> Indicates the GPIO input/output direction.</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@return</span><span class="co"> Returns {</span><span class="an">@link</span><span class="co"> </span><span class="cv">IOT_SUCCESS}</span><span class="co"> if the direction is set;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"> * returns {</span><span class="an">@link</span><span class="co"> </span><span class="cv">IOT_FAILURE}</span><span class="co"> otherwise. For details about other return values, see the chip description.</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@since</span><span class="co"> 2.2</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@version</span><span class="co"> </span><span class="cv">2.2</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">int</span> IoTGpioSetDir<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">int</span> id<span class="op">,</span> IotGpioDir dir<span class="op">);</span></span></code></pre></div>
<h3 id="iotgpiosetoutputval">4. IoTGpioSetOutputVal()</h3>
<p>作用：设置指定IO的输出电平 示例：</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>      <span class="co">/* 设置GPIO09输出低电平</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co">      * Set GPIO09 output high level to turn on red traffic light LED 3</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">      * VALUE0: low level</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">      * VALUE1: high level</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">      */</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    IoTGpioSetOutputVal<span class="op">(</span>IOT_IO_NAME_GPIO_9<span class="op">,</span> IOT_GPIO_VALUE0<span class="op">);</span></span></code></pre></div>
<h1 id="二gpio使用进阶">二、GPIO使用进阶</h1>
<h2 id="api说明-1">API说明</h2>
<h3 id="iosetpull">1. IoSetPull()</h3>
<p>作用：设置指定IO的上下拉电阻 示例：</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">     * 设置GPIO0为上拉功能</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">     * Set GPIO0 as pull-up function</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">     */</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    IoSetPull<span class="op">(</span>IOT_IO_NAME_GPIO_0<span class="op">,</span> IOT_IO_PULL_UP<span class="op">);</span></span></code></pre></div>
<p>依赖库：src-iot_demo_iot_gpio_ex.c 对第二个参数说明如下：</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** No pull */</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    IOT_IO_PULL_NONE<span class="op">,</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Pull-up */</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    IOT_IO_PULL_UP<span class="op">,</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Pull-down */</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    IOT_IO_PULL_DOWN<span class="op">,</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Maximum value */</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    IOT_IO_PULL_MAX</span></code></pre></div>
<h3 id="iotgpioregisterisrfunc">2. IoTGpioRegisterIsrFunc()</h3>
<p>作用：设置指定GPIO的中断功能 示例：</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">     * 使能GPIO0的中断功能, 上升沿触发中断，LeftBCounterHandler为中断的回调函数</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">     * Enable the interrupt function of GPIO0, the rising edge triggers</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">     * the interrupt, and LeftBCounterHandler is the interrupt callback function</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co">     */</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    IoTGpioRegisterIsrFunc<span class="op">(</span>IOT_IO_NAME_GPIO_0<span class="op">,</span> IOT_INT_TYPE_EDGE<span class="op">,</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>                           IOT_GPIO_EDGE_RISE_LEVEL_HIGH<span class="op">,</span> LeftBCounterHandler<span class="op">,</span> NULL<span class="op">);</span></span></code></pre></div>
<p>依赖库：src_hardware_gpio.h,
第二个参数<code>IotGpioIntType intType</code>说明如下</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Level-sensitive interrupt */</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    IOT_INT_TYPE_LEVEL <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Edge-sensitive interrupt */</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    IOT_INT_TYPE_EDGE</span></code></pre></div>
<p>第三个参数<code>IotGpioIntPolarity intPolarity</code>说明如下：</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Interrupt at a low level or falling edge */</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    IOT_GPIO_EDGE_FALL_LEVEL_LOW <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Interrupt at a high level or rising edge */</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    IOT_GPIO_EDGE_RISE_LEVEL_HIGH</span></code></pre></div>
<p>第四个参数<code>GpioIsrCallbackFunc func</code>，为自己编写的中断触发时的回调函数名，第五个参数<code>char *arg</code>为中断回调函数中使用的参数的指针。</p>
<h3 id="iotgpiogetinputval">IoTGpioGetInputVal()</h3>
<p>作用：读取指定GPIO的电平 示例：</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>   <span class="co">/*</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co">    * 获取GPIO8的输入电平状态</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">    * Get the input level status of GPIO8</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    IoTGpioGetInputVal<span class="op">(</span>IOT_IO_NAME_GPIO_8<span class="op">,</span> <span class="op">&amp;</span>value<span class="op">);</span></span></code></pre></div>
<p>依赖库：src_hardware_gpio.h,
IOT_GPIO_VALUE1为高电平，IOT_GPIO_VALUE0为低电平。</p>
<h2 id="i2c总线开发">I2C总线开发</h2>
<h3 id="i2c总线开发基础">1. I2C总线开发基础</h3>
<p>I2C通信中，主机通过时钟线SCL发送时钟信号，通过数据线SDA发送数据（包括从机地址、指令、数据包等），在发送完一帧数据后，需要等待从机的响应，才能继续发送下一帧数据，因此I2C属于同步通信。</p>
<h3 id="单i2c轮询">2. 单I2C轮询</h3>
<h4 id="ioti2cinit">（1）IoTI2cInit()</h4>
<p>作用：以指定的波特率初始化I2C设备。 示例：</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define IOT_I2C_IDX_BAUDRATE (400 * 1000) </span><span class="co">//指定的I2C波特率</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define CW2015_I2C_IDX 0 </span><span class="co">//I2C设备ID</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">//初始化I2C设备0，并指定波特率为400k</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>IoTI2cInit<span class="op">(</span>CW2015_I2C_IDX<span class="op">,</span> IOT_I2C_IDX_BAUDRATE<span class="op">);</span></span></code></pre></div>
<p>依赖库：src_hardware_i2c.h</p>
<h4 id="ioti2cdeinit">（2）IoTI2cDeinit()</h4>
<p>作用：关闭/去初始化指定的I2C设备。 定义：</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">int</span> IoTI2cDeinit<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">int</span> id<span class="op">);</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co">//参数：I2C设备ID</span></span></code></pre></div>
<p>依赖库：src_hardware_i2c.h</p>
<h4 id="ioti2cwrite">（3）IoTI2cWrite()</h4>
<p>作用：向指定的I2C设备写入数据。 示例：</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define LSM6DS_I2C_IDX 0</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> retval <span class="op">=</span> IoTI2cWrite<span class="op">(</span>LSM6DS_I2C_IDX<span class="op">,</span> LSM6DS_WRITE_ADDR<span class="op">,</span> buffer<span class="op">,</span> buffLen<span class="op">);</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co">//参数1：I2C设备id</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co">//参数2：I2C设备（从机）地址</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co">//参数3：指向要写入的数据的指针</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co">//参数4：要写入的数据的长度</span></span></code></pre></div>
<p>依赖库：src_hardware_i2c.h</p>
<h4 id="ioti2cread">（4）IoTI2cRead()</h4>
<p>作用：从指定的I2C设备读取数据。
注：未找到相应的示例，猜测该函数可能在驱动层面使用 定义：</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">int</span> IoTI2cRead<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">int</span> id<span class="op">,</span> <span class="dt">unsigned</span> <span class="dt">short</span> deviceAddr<span class="op">,</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>data<span class="op">,</span> <span class="dt">unsigned</span> <span class="dt">int</span> dataLen<span class="op">);</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">//参数1：I2C设备id</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co">//参数2：I2C设备（从机）地址</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co">//参数3：指向要读取的数据的指针</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co">//参数4：要读取的数据的长度</span></span></code></pre></div>
<p>依赖库：src_hardware_i2c.h</p>
<h4 id="ioti2csetbaudrate">（5）IoTI2cSetBaudrate()</h4>
<p>作用：设置指定I2C设备的波特率。 定义：</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">int</span> IoTI2cSetBaudrate<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">int</span> id<span class="op">,</span> <span class="dt">unsigned</span> <span class="dt">int</span> baudrate<span class="op">);</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co">//参数1：I2C设备id</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co">//参数2：指定的波特率</span></span></code></pre></div>
<p>依赖库：src_hardware_i2c.h</p>
<h3 id="i2c中断触发">3. I2C中断触发</h3>
<p>示例：</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="dv">195</span> <span class="dt">void</span> I2CBusExampleEntry<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="dv">196</span> <span class="op">{</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="dv">197</span>     osThreadAttr_t attr<span class="op">;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="dv">198</span> </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="dv">199</span>     I2CBusInit<span class="op">();</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="dv">200</span>     IoTWatchDogDisable<span class="op">();</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="dv">201</span> </span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="dv">202</span>     attr<span class="op">.</span>name <span class="op">=</span> <span class="st">"NFCTask"</span><span class="op">;</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="dv">203</span>     attr<span class="op">.</span>attr_bits <span class="op">=</span> <span class="dv">0</span><span class="bu">U</span><span class="op">;</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="dv">204</span>     attr<span class="op">.</span>cb_mem <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="dv">205</span>     attr<span class="op">.</span>cb_size <span class="op">=</span> <span class="dv">0</span><span class="bu">U</span><span class="op">;</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="dv">206</span>     attr<span class="op">.</span>stack_mem <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="dv">207</span>     attr<span class="op">.</span>stack_size <span class="op">=</span> <span class="dv">5</span> <span class="op">*</span> <span class="dv">1024</span><span class="op">;</span> <span class="co">// 5*1024</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="dv">208</span>     attr<span class="op">.</span>priority <span class="op">=</span> osPriorityNormal<span class="op">;</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="dv">209</span> </span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="dv">210</span>     <span class="co">// NFC</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="dv">211</span>     <span class="cf">if</span> <span class="op">(</span>osThreadNew<span class="op">((</span>osThreadFunc_t<span class="op">)</span>NFCTask<span class="op">,</span> NULL<span class="op">,</span> <span class="op">&amp;</span>attr<span class="op">)</span> <span class="op">==</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="dv">212</span>         printf<span class="op">(</span><span class="st">"[NFCTask] Failed to create NFCTask!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="dv">213</span>     <span class="op">}</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="dv">214</span> </span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a><span class="dv">215</span>     <span class="co">// 电量监测</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a><span class="dv">216</span>     attr<span class="op">.</span>name <span class="op">=</span> <span class="st">"CW2015Task"</span><span class="op">;</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a><span class="dv">217</span>     <span class="cf">if</span> <span class="op">(</span>osThreadNew<span class="op">((</span>osThreadFunc_t<span class="op">)</span>CW2015Task<span class="op">,</span> NULL<span class="op">,</span> <span class="op">&amp;</span>attr<span class="op">)</span> <span class="op">==</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a><span class="dv">218</span>         printf<span class="op">(</span><span class="st">"[CW2015Task] Failed to create CW2015Task!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a><span class="dv">219</span>     <span class="op">}</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a><span class="dv">220</span> </span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a><span class="dv">221</span>     <span class="co">// 功能按键</span></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a><span class="dv">222</span>     attr<span class="op">.</span>name <span class="op">=</span> <span class="st">"FunKeyTask"</span><span class="op">;</span></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a><span class="dv">223</span>     <span class="cf">if</span> <span class="op">(</span>osThreadNew<span class="op">((</span>osThreadFunc_t<span class="op">)</span>FunKeyTask<span class="op">,</span> NULL<span class="op">,</span> <span class="op">&amp;</span>attr<span class="op">)</span> <span class="op">==</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a><span class="dv">224</span>         printf<span class="op">(</span><span class="st">"[FunKeyTask] Failed to create FunKeyTask!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a><span class="dv">225</span>     <span class="op">}</span></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a><span class="dv">226</span> </span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a><span class="dv">227</span>     <span class="co">// 陀螺仪</span></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a><span class="dv">228</span>     attr<span class="op">.</span>name <span class="op">=</span> <span class="st">"LSM6DSTask"</span><span class="op">;</span></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a><span class="dv">229</span>     <span class="cf">if</span> <span class="op">(</span>osThreadNew<span class="op">((</span>osThreadFunc_t<span class="op">)</span>LSM6DSTask<span class="op">,</span> NULL<span class="op">,</span> <span class="op">&amp;</span>attr<span class="op">)</span> <span class="op">==</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a><span class="dv">230</span>         printf<span class="op">(</span><span class="st">"[LSM6DSTask] Failed to create LSM6DSTask!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a><span class="dv">231</span>     <span class="op">}</span></span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a><span class="dv">232</span> <span class="op">}</span></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a><span class="dv">233</span> </span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a><span class="dv">234</span> APP_FEATURE_INIT<span class="op">(</span>I2CBusExampleEntry<span class="op">);</span></span></code></pre></div>
<p>软件烧录成功后，按一下开发板的RESET按键复位开发板，可以在OLED屏幕上面看到陀螺仪方向角实时数据以及电池电量数据，当手机靠近小车的NFC模块时，NFC会拉起手机的淘宝应用，且可以通过S1、S2、S3功能按键来控制三个交通灯的亮灭，说明我们使用I2C总线，实现同时轮询多个设备的实验成功。</p>
<h2 id="pwm接口开发">PWM接口开发</h2>
<h3 id="iotpwminit">1. IoTPwmInit()</h3>
<p>作用：初始化指定PWM端口 示例：</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>   <span class="pp">#define IOT_PWM_PORT_PWM1   1</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 初始化PWM1 Initialize PWM1</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  IoTPwmInit<span class="op">(</span>IOT_PWM_PORT_PWM1<span class="op">);</span></span></code></pre></div>
<p>依赖库：src_hardware_pwm.h 返回值：<br>
IOT_SUCCESS：初始化成功 IOT_FAILURE：初始化失败</p>
<h3 id="iotpwmstart">2. IoTPwmStart()</h3>
<p>作用：启动PWM信号输出 示例：</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>  <span class="pp">#define IOT_PWM_PORT_PWM2   2</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="pp">#define IOT_FREQ            65535</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="pp">#define IOT_DUTY            50</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  IoTPwmStart<span class="op">(</span>IOT_PWM_PORT_PWM2<span class="op">,</span> IOT_DUTY<span class="op">,</span> IOT_FREQ<span class="op">);</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">//参数1：指定的PWM端口</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">//参数2：PWM输出占空比，范围1-99</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">//参数3：PWM输出频率，范围1-65535</span></span></code></pre></div>
<p>依赖库：src_hardware_pwm.h</p>
<h3 id="iotpwmstop">3. IoTPwmStop()</h3>
<p>作用：停止PWM信号输出 示例：</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>  <span class="pp">#define IOT_PWM_PORT_PWM2   2</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  IoTPwmStop<span class="op">(</span>IOT_PWM_PORT_PWM2<span class="op">);</span></span></code></pre></div>
<p>依赖库：src_hardware_pwm.h</p>
<h3 id="iotpwmdeinit">IoTPwmDeinit()</h3>
<p>作用：释放/去初始化指定PWM端口 示例：</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>  <span class="pp">#define IOT_PWM_PORT_PWM2   2</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  IoTPwmDeinit<span class="op">(</span>IOT_PWM_PORT_PWM2<span class="op">);</span></span></code></pre></div>
<p>依赖库：src_hardware_pwm.h</p>
<h2 id="gpio模拟pwm信号">GPIO模拟PWM信号</h2>
<h3 id="sg92r舵机原理">Sg92r舵机原理</h3>
<p>Sg92舵机的控制需要产生一个<strong>20ms</strong>的脉冲信号，以<strong>0.5ms到2.5ms</strong>的<em>高电平</em>来控制舵机的角度；高电平持续时间对应角度如下表所示。</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">高电平持续时间</th>
<th style="text-align: center;">角度</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0.5ms</td>
<td style="text-align: center;">0°</td>
</tr>
<tr class="even">
<td style="text-align: center;">1.0ms</td>
<td style="text-align: center;">45°</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1.5ms</td>
<td style="text-align: center;">90°</td>
</tr>
<tr class="even">
<td style="text-align: center;">2.0ms</td>
<td style="text-align: center;">135°</td>
</tr>
<tr class="odd">
<td style="text-align: center;">2.5ms</td>
<td style="text-align: center;">180°</td>
</tr>
</tbody>
</table>
<h3 id="代码核心">代码核心</h3>
<div class="sourceCode" id="cb32"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="dv">30</span> <span class="dt">void</span> SetAngle<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">int</span> duty<span class="op">)</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="dv">31</span> <span class="op">{</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="dv">32</span>     <span class="dt">unsigned</span> <span class="dt">int</span> time <span class="op">=</span> FREQ_TIME<span class="op">;</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="dv">33</span> </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="dv">34</span>     IoTGpioSetOutputVal<span class="op">(</span>IOT_IO_NAME_GPIO_2<span class="op">,</span> IOT_GPIO_VALUE1<span class="op">);</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="dv">35</span>     hi_udelay<span class="op">(</span>duty<span class="op">);</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="dv">36</span>     IoTGpioSetOutputVal<span class="op">(</span>IOT_IO_NAME_GPIO_2<span class="op">,</span> IOT_GPIO_VALUE0<span class="op">);</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="dv">37</span>     hi_udelay<span class="op">(</span>time <span class="op">-</span> duty<span class="op">);</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="dv">38</span> <span class="op">}</span></span></code></pre></div>
<h2 id="adc开发">ADC开发</h2>
<h3 id="adcread">1.AdcRead()</h3>
<p>作用：根据输入参数从指定的ADC通道读取一段采样数据 示例：</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>ret <span class="op">=</span> AdcRead<span class="op">(</span>idx<span class="op">,</span> <span class="op">&amp;</span>data<span class="op">,</span> IOT_ADC_EQU_MODEL_4<span class="op">,</span> IOT_ADC_CUR_BAIS_DEFAULT<span class="op">,</span> <span class="bn">0xff</span><span class="op">);</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co">//参数1：表示指定的ADC通道</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co">//参数2：表示指向存储读取数据的地址的指针</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co">//参数3：eqmodel表示方程模型、</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co">//参数4：curBais表示模拟功率控制模式</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co">//参数5：rstCnt表示从重置到转换开始的时间计数(一次计数是334ns，其值需在0~0xFF0之间)</span></span></code></pre></div>
<p>依赖库：src-iot_demo_adc.h</p>
<h2 id="uart开发">UART开发</h2>
<h3 id="iotuartinit">1. IoTUartInit()</h3>
<p>作用：初始化指定UART端口 示例：</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    ret <span class="op">=</span> IoTUartInit<span class="op">(</span>HI_UART_IDX_1<span class="op">,</span> <span class="op">&amp;</span>uart_attr<span class="op">);</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ret <span class="op">!=</span> IOT_SUCCESS<span class="op">)</span> <span class="op">{</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Init Uart1 Falied Error No : %d</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> ret<span class="op">);</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<p>依赖库：src_hardware_uart.h</p>
<h1 id="作品设想">作品设想</h1>
<h2 id="作品功能">1. 作品功能</h2>
<h3 id="a.基础设施智能化建设解决方案">A.基础设施智能化建设解决方案</h3>
<p>将小区分为社区门口、单元门、电梯间、入户门、停车场、公共区域、设备间7
个重点区域，对门禁、道闸、对讲、梯控、视频监控、周界防范、信息发布、停车管理、设备检测等进行基础设施智能化开发与建设，为智慧社区整体方案提供支撑，基础设施见图：
<img src="/2023/03/27/03-Hi3861-Embedded-Competition/01.jpg" alt="fig01"></p>
<p>最终敲定功能：
小区设备综合管控：供电监测、水暖系统、排水系统、通风系统的设备情况实时监测
人脸、车牌识别： 电梯设备状态监控：
与市气象站数据整合，小区植被喷淋系统</p>
<p>主要工作：Hi3861开发板学习、各种传感器选型、解决方案敲定等。</p>
<h3 id="b.物业综合服务平台">B.物业综合服务平台</h3>
<p>该平台用于：完成人员管理、养老服务、卫生服务、信息发布、收缴费管理、报事报修、车辆管理、便民服务等功能开发；为物业提供社区基础数据、日常业务管理工具，通过数据共享和应用聚合向政府提供社区管理通道、向居民提供社区服务。平台服务与应用见图4：
<img src="/2023/03/27/03-Hi3861-Embedded-Competition/02.jpg" alt="fig02"></p>
<p>主要工作：华为云服务的学习与配置，物业综合服务平台的开发。</p>
<h2 id="项目故事">项目故事</h2>
<p>物业&lt;-&gt;USER/业主&lt;-&gt;政府/社区 双向的故事
双向的沟通交流，贴近居民生活，提高居民生活质量。</p>
<h2 id="海思camp">海思CAMP</h2>
<h3 id="项目管理方法">项目管理方法</h3>
<h2 id="传感器选型">传感器选型</h2>
<h3 id="电能监控模块">电能监控模块</h3>
<p>艾锐达IM1253B交直流电压电流功率电量测量电能采集电测计量模块 ref:<a target="_blank" rel="noopener" href="https://item.taobao.com/item.htm?spm=a21n57.1.0.0.7b90523cKNbIy1&amp;id=571489221834&amp;ns=1&amp;abbucket=0#detail" class="uri">https://item.taobao.com/item.htm?spm=a21n57.1.0.0.7b90523cKNbIy1&amp;id=571489221834&amp;ns=1&amp;abbucket=0#detail</a></p>
<h3 id="流量计模块">流量计模块</h3>

    </div>
    
    
    
    <div id="comment">
        <div id="gitalk-container"></div>
    </div>
    
    
    
    
    
</div>

                <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2023 - 2023 EZ0328
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;Eric Zhang
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

            </div>
            </transition>
            
            <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
            </transition>
            
        </div>
        <script src="/js/main.js"></script>
        
        
<script>
    let clientID = "687e760e080fe80a4308",
        clientSecret = "42e0ab633bd94122a6eae2d2081c42480bf4dee5";
    
    const gitalk = new Gitalk({
        clientID: clientID,
        clientSecret: clientSecret,
        repo: "Comments",
        owner: "EricZhang1412",
        admin: ["EricZhang1412"],
        language: "zh-CN",
        id: location.pathname,
        distractionFreeMode: false,
        
    })
    gitalk.render("gitalk-container");
</script>





        
    </body>
</html>
